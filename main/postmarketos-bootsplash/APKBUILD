maintainer="Casey Connolly <kcxt@postmarketos.org>"
pkgname=postmarketos-bootsplash
pkgver=0.4.0
pkgrel=0
pkgdesc="pmOS integration components for pbsplash"
url="https://postmarketos.org"
arch="all"
license="CC-BY-SA-3.0"
depends="
	devicepkg-utils
	font-droid
	plymouth
	plymouth-drm
	postmarketos-plymouth-themes
"
options="!check" # no testsuite
subpackages="$pkgname-openrc"
source="
	plymouthd.conf
	20-plymouth.conf
	99-shutdown-pbsplash.stop
	postmarketos-bootsplash.files
"
replaces="plymouth"

package() {
	# FIXME: openrc.... ugh
	# install -Dm755 "$srcdir/kill-pbsplash" -t "$pkgdir"/etc/init.d/
	install -Dm755 "$srcdir/99-shutdown-pbsplash.stop" -t "$pkgdir"/etc/local.d/

	# NOTE: install files to initramfs-extra due to size
	install -Dm644 "$srcdir"/postmarketos-bootsplash.files \
		"$pkgdir"/usr/share/mkinitfs/files-extra/30-postmarketos-bootsplash.files

	install -Dm644 "$srcdir"/plymouthd.conf \
		"$pkgdir"/usr/share/plymouth/plymouthd.defaults

	touch bootsplash-trigger
	install -Dm644 bootsplash-trigger \
		"$pkgdir"/usr/share/mkinitfs-triggers/bootsplash

	install -Dm644 20-plymouth.conf -t "$pkgdir"/usr/lib/kernel-cmdline.d
}

openrc() {
	install="$subpkgname.post-install"
	default_openrc

	# FIXME:
	mkdir -p "$subpkgdir"
}

sha512sums="
df6e6261b65efcf8d13bd6bcf0d7adbd8631d7a1c9311bb4056f665a4645d96379b6f6325786d7a55f4f4f668420ec326644eda7f62624b0be883504f719b094  plymouthd.conf
d105d23d190f48e106b905ccaa8648f61e82e43a1d7425d6316d9c1073b87b3e2cc8a72e044a8e0b36460f6ddfaef4130dae3257e2cee90d446821ae4f059b57  20-plymouth.conf
ad54176548c67bb1cb1208588847d0269c388b61fc3a96ec775b747c3d90d3402a016e50146858c70552f3f4159cfba2d88598edd930e1127cf79b2eb9bdcfff  99-shutdown-pbsplash.stop
1865b18ca391d6257d11abb534ac1e5ba816181b1b6a66eeafb6eb23a0abf8662e3e3afe7a703cf8a74ffa4cb7bc74efdcd1d4654dfc5bbb706b805b0b607a47  postmarketos-bootsplash.files
"
