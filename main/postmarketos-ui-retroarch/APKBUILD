# Reference: https://postmarketos.org/uipkg
# Maintainer: Sandelinos <postmarketos@sandelinos.me>
pkgname=postmarketos-ui-retroarch
pkgver=2
pkgrel=0
pkgdesc="RetroArch in KMS mode"
url="https://www.retroarch.com"
arch="noarch"
license="GPL-3.0-or-later"
depends="
	elogind
	postmarketos-base-ui
	postmarketos-base-ui-audio
	postmarketos-base-ui-networkmanager
	retroarch
	tinydm
	"
depends_systemd="polkit-systemd"
subpackages="$pkgname-openrc $pkgname-systemd"
source="
	retroarch.cfg
	retroarch.desktop
	"
options="!check pmb:drm"
install="$pkgname.post-install"
# Note: for adding a new skeleton config in /etc/retroarch.cfg:
replaces="retroarch"

package() {
	install -Dm644 retroarch.cfg -t "$pkgdir"/etc/

	# Ok ok this isn't *really* wayland, but tinydm doesn't care and it runs
	# retroarch just fine...
	install -Dm644 retroarch.desktop -t "$pkgdir"/usr/share/wayland-sessions/
}

openrc() {
	install="$subpkgname.post-install $subpkgname.post-upgrade"
	depends="elogind-openrc polkit-elogind"
	mkdir -p "$subpkgdir"

	default_openrc
}

systemd() {
	mkdir -p "$subpkgdir"

	default_systemd
}

sha512sums="
9c71418cdddbaff028431a58b04924ed5360bafd3a08fb50edd48f8f27ed353f25c2c6d6db4b85b44f7f556e9552d7d1914e3278bfb6ca0b7fb8478ef6ab50ae  retroarch.cfg
f25843d7a95c3c01e6ce709d55398d3696bcb429fd6913f9bab9623151b8f12a601d9d53973581c54f0ae562e1080d40631aa491dc1cd8179848a878848a5a33  retroarch.desktop
"
