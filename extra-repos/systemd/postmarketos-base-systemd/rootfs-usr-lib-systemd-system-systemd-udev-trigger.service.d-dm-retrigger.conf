[Service]
# dm devices created by kpartx in initramfs have DM_UDEV_DISABLE_* flags set.
# These flags persist in /run/udev/data/ through switch_root. When the main
# trigger runs with --action=add, 10-dm.rules treats existing dm devices as
# spurious add events and re-enables the disable flags, causing SYSTEMD_READY=0.
# This makes systemd ignore the devices, leading to long (e.g. 90s) timeouts
# waiting for /dev/disk/by-partuuid/ symlinks that never appear (used by
# veritysetup, fstab, etc). Retriggering with --action=change seems to clear
# the flags.
ExecStartPost=-udevadm trigger --subsystem-match=block --sysname-match='dm-*' --action=change --verbose
